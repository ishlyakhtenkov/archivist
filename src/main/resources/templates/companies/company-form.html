<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:with="activeMenuItem='Companies'" lang="en">

<th:block th:replace="~{fragments/main::page(title='Archivist - companies',appMain=~{::appMain}, ownScript=~{::ownScript})}">
    <appMain>
        <!-- Create company card -->
        <div class="row d-flex justify-content-center align-items-center">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header">
                        <span class="float-end">
                            <button type="button" class="btn-close" aria-label="Close" onclick="closeCard()"></button>
                        </span>
                        <h3 class="text-center ms-4" th:text="${company.isNew()} ? 'New company' : 'Editing: ' + ${company.name}">Create/Edit company</h3>
                    </div>
                    <div class="card-body text-center">
                        <form th:action="@{/companies}" method="post" th:object="${company}">
                            <input type="hidden" th:field="*{id}">
                            <div class="row">
                                <div class="col-lg-4">
                                    <div class="mb-3">
                                        <div class="input-group">
                                            <span class="input-group-text" id="nameAddon"><i class="fa-solid fa-landmark fa-fw"></i></span>
                                            <div class="form-floating">
                                                <input type="text" th:field="*{name}" id="companyNameInput"
                                                       th:class="${#fields.hasErrors('name')} ? 'form-control is-invalid' : 'form-control'"
                                                       required placeholder="Name" title="" aria-label="Name" aria-describedby="nameAddon"/>
                                                <label for="companyNameInput" class="text-muted">Name</label>
                                            </div>
                                        </div>
                                        <span class="help-block" th:if="${#fields.hasErrors('name')}">
                                            <ul>
                                                <li class="text-danger text-start"
                                                    th:each="err : ${#fields.errors('name')}" th:text="${err}"/>
                                            </ul>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="mb-3">
                                        <div class="input-group">
                                            <span class="input-group-text" id="countryAddon"><i class="fa-solid fa-flag fa-fw"></i></span>
                                            <div class="form-floating">
                                                <input type="text" th:field="*{address.country}" id="countryInput"
                                                       th:class="${#fields.hasErrors('address.country')} ? 'form-control is-invalid' : 'form-control'"
                                                       required placeholder="Country" title="" aria-label="Country" aria-describedby="countryAddon"/>
                                                <label for="countryInput" class="text-muted">Country</label>
                                            </div>
                                        </div>
                                        <span class="help-block" th:if="${#fields.hasErrors('address.country')}">
                                            <ul>
                                                <li class="text-danger text-start"
                                                    th:each="err : ${#fields.errors('address.country')}" th:text="${err}"/>
                                            </ul>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="mb-3">
                                        <div class="input-group">
                                            <span class="input-group-text" id="zipcodeAddon"><i class="fa-solid fa-barcode fa-fw"></i></span>
                                            <div class="form-floating">
                                                <input type="text" th:field="*{address.zipcode}" id="zipcodeInput"
                                                       th:class="${#fields.hasErrors('address.zipcode')} ? 'form-control is-invalid' : 'form-control'"
                                                       required placeholder="Zipcode" title="" aria-label="Zipcode" aria-describedby="zipcodeAddon"/>
                                                <label for="zipcodeInput" class="text-muted">Zipcode</label>
                                            </div>
                                        </div>
                                        <span class="help-block" th:if="${#fields.hasErrors('address.zipcode')}">
                                            <ul>
                                                <li class="text-danger text-start" th:each="err : ${#fields.errors('address.zipcode')}"
                                                    th:text="${err}"/>
                                            </ul>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-4">
                                    <div class="mb-3">
                                        <div class="input-group">
                                            <span class="input-group-text" id="cityAddon"><i class="fa-solid fa-city fa-fw"></i></span>
                                            <div class="form-floating">
                                                <input type="text" th:field="*{address.city}" id="cityInput"
                                                       th:class="${#fields.hasErrors('address.city')} ? 'form-control is-invalid' : 'form-control'"
                                                       required placeholder="City" title="" aria-label="City" aria-describedby="cityAddon"/>
                                                <label for="cityInput" class="text-muted">City</label>
                                            </div>
                                        </div>
                                        <span class="help-block" th:if="${#fields.hasErrors('address.city')}">
                                            <ul>
                                                <li class="text-danger text-start" th:each="err : ${#fields.errors('address.city')}"
                                                    th:text="${err}"/>
                                            </ul>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="mb-3">
                                        <div class="input-group">
                                            <span class="input-group-text" id="streetAddon"><i class="fa-solid fa-road fa-fw"></i></span>
                                            <div class="form-floating">
                                                <input type="text" th:field="*{address.street}" id="streetInput"
                                                       th:class="${#fields.hasErrors('address.street')} ? 'form-control is-invalid' : 'form-control'"
                                                       required placeholder="Street" title="" aria-label="Street" aria-describedby="streetAddon"/>
                                                <label for="streetInput" class="text-muted">Street</label>
                                            </div>
                                        </div>
                                        <span class="help-block" th:if="${#fields.hasErrors('address.street')}">
                                            <ul>
                                                <li class="text-danger text-start" th:each="err : ${#fields.errors('address.street')}"
                                                    th:text="${err}"/>
                                            </ul>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="mb-3">
                                        <div class="input-group">
                                            <span class="input-group-text" id="houseAddon"><i class="fa-solid fa-house fa-fw"></i></span>
                                            <div class="form-floating">
                                                <input type="text" th:field="*{address.house}" id="houseInput"
                                                       th:class="${#fields.hasErrors('address.house')} ? 'form-control is-invalid' : 'form-control'"
                                                       required placeholder="House" title="" aria-label="House" aria-describedby="houseAddon"/>
                                                <label for="houseInput" class="text-muted">House</label>
                                            </div>
                                        </div>
                                        <span class="help-block" th:if="${#fields.hasErrors('address.house')}">
                                            <ul>
                                                <li class="text-danger text-start" th:each="err : ${#fields.errors('address.house')}"
                                                    th:text="${err}"/>
                                            </ul>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-4">
                                    <div class="mb-2">
                                        <div class="input-group">
                                            <span class="input-group-text" id="phoneAddon"><i class="fa-solid fa-phone fa-fw"></i></span>
                                            <div class="form-floating">
                                                <input type="text" th:field="*{contacts.phone}" id="phoneInput"
                                                       th:class="${#fields.hasErrors('contacts.phone')} ? 'form-control is-invalid' : 'form-control'"
                                                       placeholder="Phone number" aria-label="Phone number" aria-describedby="phoneAddon"/>
                                                <label for="phoneInput" class="text-muted">Phone number</label>
                                            </div>
                                        </div>
                                        <span class="help-block" th:if="${#fields.hasErrors('contacts.phone')}">
                                            <ul>
                                                <li class="text-danger text-start" th:each="err : ${#fields.errors('contacts.phone')}"
                                                    th:text="${err}"/>
                                            </ul>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="mb-2">
                                        <div class="input-group">
                                            <span class="input-group-text" id="faxAddon"><i class="fa-solid fa-fax fa-fw"></i></span>
                                            <div class="form-floating">
                                                <input type="text" th:field="*{contacts.fax}" id="faxInput"
                                                       th:class="${#fields.hasErrors('contacts.fax')} ? 'form-control is-invalid' : 'form-control'"
                                                       placeholder="Fax" aria-label="Fax" aria-describedby="faxAddon"/>
                                                <label for="faxInput" class="text-muted">Fax</label>
                                            </div>
                                        </div>
                                        <span class="help-block" th:if="${#fields.hasErrors('contacts.fax')}">
                                            <ul>
                                                <li class="text-danger text-start" th:each="err : ${#fields.errors('contacts.fax')}"
                                                    th:text="${err}"/>
                                            </ul>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="mb-2">
                                        <div class="input-group">
                                            <span class="input-group-text" id="emailAddon"><i class="fa-solid fa-envelope fa-fw"></i></span>
                                            <div class="form-floating">
                                                <input type="text" th:field="*{contacts.email}" id="emailInput"
                                                       th:class="${#fields.hasErrors('contacts.email')} ? 'form-control is-invalid' : 'form-control'"
                                                       placeholder="E-mail" aria-label="E-mail" aria-describedby="emailAddon"/>
                                                <label for="emailInput" class="text-muted">E-mail</label>
                                            </div>
                                        </div>
                                        <span class="help-block" th:if="${#fields.hasErrors('contacts.email')}">
                                            <ul>
                                                <li class="text-danger text-start" th:each="err : ${#fields.errors('contacts.email')}"
                                                    th:text="${err}"/>
                                            </ul>
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <!-- Contact persons block -->
                            <div class="text-start mb-1">
                                <div class="row">
                                    <div class="col-7">
                                        <h4 class="text-secondary">Contact persons</h4>
                                    </div>
                                    <div class="col-5 text-end">
                                        <button type="button" class="btn btn-sm btn-primary" onclick="addContactPersonRow()">Add contact</button>
                                    </div>
                                </div>
                                <div id="contactPersonBlock" class="mt-1">
                                    <div th:each="contactPerson, itemStat : *{contactPersons}" class="row contact-person-row">
                                        <div class="col-lg-3">
                                            <div class="mb-3">
                                                <div class="form-floating">
                                                    <input type="text" th:id="${'contactPersons-' + itemStat.index + '-position'}" th:field="*{contactPersons[__${itemStat.index}__].position}"
                                                           th:class="${#fields.hasErrors('contactPersons[__${itemStat.index}__].position')} ? 'form-control is-invalid' : 'form-control'" required placeholder="Position" />
                                                    <label th:for="${'contactPersons-' + itemStat.index + '-position'}" class="text-muted">Position</label>
                                                </div>
                                                <span class="help-block" th:if="${#fields.hasErrors('contactPersons[__${itemStat.index}__].position')}">
                                                    <ul>
                                                        <li class="text-danger text-start"
                                                            th:each="err : ${#fields.errors('contactPersons[__${itemStat.index}__].position')}" th:text="${err}"/>
                                                    </ul>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="col-lg-2">
                                            <div class="mb-3">
                                                <div class="form-floating">
                                                    <input type="text" th:id="${'contactPersons-' + itemStat.index + '-lastName'}" th:field="*{contactPersons[__${itemStat.index}__].lastName}"
                                                           th:class="${#fields.hasErrors('contactPersons[__${itemStat.index}__].lastName')} ? 'form-control is-invalid' : 'form-control'" required placeholder="Last name" />
                                                    <label th:for="${'contactPersons-' + itemStat.index + '-lastName'}" class="text-muted">Last name</label>
                                                </div>
                                                <span class="help-block" th:if="${#fields.hasErrors('contactPersons[__${itemStat.index}__].lastName')}">
                                                    <ul>
                                                        <li class="text-danger text-start"
                                                            th:each="err : ${#fields.errors('contactPersons[__${itemStat.index}__].lastName')}" th:text="${err}"/>
                                                    </ul>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="col-lg-2">
                                            <div class="mb-3">
                                                <div class="form-floating">
                                                    <input type="text" th:id="${'contactPersons-' + itemStat.index + '-firstName'}" th:field="*{contactPersons[__${itemStat.index}__].firstName}"
                                                           th:class="${#fields.hasErrors('contactPersons[__${itemStat.index}__].firstName')} ? 'form-control is-invalid' : 'form-control'" required placeholder="First name" />
                                                    <label th:for="${'contactPersons-' + itemStat.index + '-firstName'}" class="text-muted">First name</label>
                                                </div>
                                                <span class="help-block" th:if="${#fields.hasErrors('contactPersons[__${itemStat.index}__].firstName')}">
                                                    <ul>
                                                        <li class="text-danger text-start"
                                                            th:each="err : ${#fields.errors('contactPersons[__${itemStat.index}__].firstName')}" th:text="${err}"/>
                                                    </ul>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="col-lg-2">
                                            <div class="mb-3">
                                                <div class="form-floating">
                                                    <input type="text" th:id="${'contactPersons-' + itemStat.index + '-middleName'}" th:field="*{contactPersons[__${itemStat.index}__].middleName}"
                                                           th:class="${#fields.hasErrors('contactPersons[__${itemStat.index}__].middleName')} ? 'form-control is-invalid' : 'form-control'" required placeholder="Middle name" />
                                                    <label th:for="${'contactPersons-' + itemStat.index + '-middleName'}" class="text-muted">Middle name</label>
                                                </div>
                                                <span class="help-block" th:if="${#fields.hasErrors('contactPersons[__${itemStat.index}__].middleName')}">
                                                    <ul>
                                                        <li class="text-danger text-start"
                                                            th:each="err : ${#fields.errors('contactPersons[__${itemStat.index}__].middleName')}" th:text="${err}"/>
                                                    </ul>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="col-lg-2">
                                            <div class="mb-3">
                                                <div class="form-floating">
                                                    <input type="text" th:id="${'contactPersons-' + itemStat.index + '-phone'}" th:field="*{contactPersons[__${itemStat.index}__].phone}"
                                                           th:class="${#fields.hasErrors('contactPersons[__${itemStat.index}__].phone')} ? 'form-control is-invalid' : 'form-control'" placeholder="Phone" />
                                                    <label th:for="${'contactPersons-' + itemStat.index + '-phone'}" class="text-muted">Phone number</label>
                                                </div>
                                                <span class="help-block" th:if="${#fields.hasErrors('contactPersons[__${itemStat.index}__].phone')}">
                                                    <ul>
                                                        <li class="text-danger text-start"
                                                            th:each="err : ${#fields.errors('contactPersons[__${itemStat.index}__].phone')}" th:text="${err}"/>
                                                    </ul>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="col-lg-1 text-end">
                                            <div class="mb-3">
                                                <span class="d-lg-none d-grid">
                                                   <button type="button" th:id="${'deleteContactBtn-' + itemStat.index}" class="btn btn-sm btn-danger btn-del-contact-person">
                                                       <i class="fa-solid fa-arrow-up"></i> Delete contact <i class="fa-solid fa-arrow-up"></i>
                                                   </button>
                                                </span>
                                                <span class="d-none d-lg-block py-1">
                                                    <button type="button" th:id="${'deleteContactBtn-' + itemStat.index}" class="btn btn-sm btn-danger btn-del-contact-person mt-1">
                                                        Delete
                                                    </button>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="text-end">
                                <button th:if="${!company.isNew()}" class="btn btn-secondary" type="button" onclick="cancelCard()">Cancel</button>
                                <button class="btn btn-success px-3" type="submit" th:text="${company.isNew()} ? '&nbsp;Create&nbsp;' : '&nbsp;Save&nbsp;'">Create/Save</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </appMain>

    <ownScript>
        <script src="/js/company-form.js?v=1"></script>
        <script src="/js/close-card-button.js?v=1"></script>
        <script src="/js/cancel-card-button.js?v=1"></script>
    </ownScript>
</th:block>
